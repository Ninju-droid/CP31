#include <bits/stdc++.h>
using namespace std;
typedef long long ll ;
ll mod = 1e9+7;

void fun() {
    ll n,k; cin>>n>>k; 
    string s;cin>>s; 
    
    for(ll i=0;i<k;i++){
        ll z=0,o=0;
        for(ll j=i;j<n;j+=k){
            if(s[j]=='1')o++;
            else if(s[j]=='0')z++;
        }
        if(z && o){cout<<"NO"<<endl;return;}
        if (z || o){
            for(ll j=i;j<n;j+=k){
              if(z)s[j]='0';
              else s[j]='1';
            }
        }
    }

    ll z =0,o=0;
    for(ll i=0;i<k;i++){
        if(s[i]=='1')o++;
        else if(s[i]=='0')z++;
    }
    ll left = 1,right = k;
    while(right<n){
        if(z>k/2 || o>k/2){cout<<"NO"<<endl;return;}
        if(s[left-1]=='1')o--;
        else if(s[left-1]=='0')z--; 

        if(s[right]=='0')z++;
        else if(s[right]=='1')o++;
        left++ ;right++;
    }
    if(z>k/2 || o>k/2){cout<<"NO"<<endl;return;}
    cout<<"YES"<<endl;
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(nullptr);
#ifndef ONLINE_JUDGE
    freopen("Input.txt", "r", stdin);
    freopen("Output.txt", "w", stdout);
#endif
    int t;
    cin >> t;
    while (t--) fun();
}